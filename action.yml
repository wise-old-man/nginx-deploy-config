name: 'Wise Old Man NGINX Deploy Config'
description: 'Builds and deploys all the code on the Wise Old Man project.'
runs:
  using: 'docker'
  image: 'Dockerfile'
  steps:
    - name: Build NGINX image
      run: |
        docker build . --file Dockerfile --tag wiseoldman/nginx-deploy-config:latest
        docker push wiseoldman/nginx-deploy-config:latest
    - name: Deploy to Host
      uses: appleboy/ssh-action@master
      env:
        GITHUB_USERNAME: ${{ secrets.GITHUB_USERNAME }}
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        host: ${{ secrets.DO_HOST }}
        username: ${{ secrets.DO_USER }}
        passphrase: ${{ secrets.DO_SSH_PASS }}
        key: ${{ secrets.DO_SSH_KEY }}
        envs: GITHUB_USERNAME, GITHUB_TOKEN
        script: |
          cd wise-old-man
          docker-compose pull
          docker-compose up -d
